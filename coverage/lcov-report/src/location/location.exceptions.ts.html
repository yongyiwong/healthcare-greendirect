<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/location/location.exceptions.ts</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../index.html">All files</a> / <a href="index.html">src/location</a> location.exceptions.ts
    </h1>
    <div class='clearfix'>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">27x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">21x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import { ExpectedExceptionMap } from '../app.interface';
import { HttpStatus } from '@nestjs/common';
import { differenceInCalendarDays, parse } from 'date-fns';
&nbsp;
import { LocationRating } from '../entities/location-rating.entity';
import { MobileCheckIn } from '../entities/mobile-check-in.entity';
&nbsp;
export const LocationExceptions: ExpectedExceptionMap = {
  locationNotFound: {
    message: 'Error: Location not found.',
    httpStatus: HttpStatus.NOT_FOUND,
    failCondition: location =&gt; !location,
    i18n: { 'es-PR': 'Ubicación no encontrada.' },
  },
  invalidStartingLatLong: {
    message:
      'Starting coordinates for sorting nearest locations are incomplete.',
    httpStatus: HttpStatus.BAD_REQUEST,
    failCondition: ({ startFromLong, startFromLat }) =&gt;
      // XOR operator: startingLongLat param is optional but if present, both must be provided.
      startFromLat ? !startFromLong : startFromLong,
    i18n: {
      'es-PR':
        'Las coordenadas de inicio para la clasificación de las ubicaciones más cercanas están incompletas.',
    },
  },
  addReviewSpam: {
    message: 'You can only leave 1 review per listing every 30 days.',
    httpStatus: HttpStatus.BAD_REQUEST,
    failCondition: recentCount =&gt; recentCount &gt; 0,
    i18n: { 'es-PR': 'Solo puedes dejar 1 opinión por listado cada 30 días.' },
  },
  invalidTimeRange: {
    message: 'Invalid time range.',
    httpStatus: HttpStatus.BAD_REQUEST,
    i18n: { 'es-PR': 'Rango de tiempo no válido.' },
  },
  invalidTime: {
    message: 'Invalid time.',
    httpStatus: HttpStatus.BAD_REQUEST,
    i18n: { 'es-PR': 'Tiempo inválido' },
  },
  reviewNotFound: {
    message: 'Review not found.',
    httpStatus: HttpStatus.NOT_FOUND,
    failCondition: (review: LocationRating) =&gt; !review || !review.id,
    i18n: { 'es-PR': 'Revisión no encontrada.' },
  },
  invalidCoordinates: {
    message: 'Invalid coordinates.',
    httpStatus: HttpStatus.UNPROCESSABLE_ENTITY,
    failCondition: (longLat: string) =&gt; {
      const coordinatesPattern = /^\((.*),(.*)\)$/;
      const matches = longLat.match(coordinatesPattern);
      <span class="missing-if-branch" title="if path not taken" >I</span>if (!matches) {
<span class="cstat-no" title="statement not covered" >        return true;</span>
      }
&nbsp;
      const [, long, lat] = matches;
      const validLat = -90 &lt;= +lat &amp;&amp; +lat &lt;= 90;
      const validLong = -180 &lt;= +long &amp;&amp; +long &lt;= 180;
      return !validLat || !validLong;
    },
    i18n: { 'es-PR': 'Coordenadas inválidas' },
  },
  nearestLocationNotFound: {
    message: 'No nearby location.',
    httpStatus: HttpStatus.NOT_FOUND,
    failCondition: location =&gt; !location,
    i18n: { 'es-PR': 'No hay ubicaciones cercanas.' },
  },
  longLatRequired: {
    message: 'Please provide your starting location.',
    httpStatus: HttpStatus.BAD_REQUEST,
    failCondition: ({ startFromLong, startFromLat }) =&gt; {
      return !startFromLong || !startFromLat;
    },
    i18n: { 'es-PR': 'Proporcione su ubicación inicial.' },
  },
  checkinRestricted: {
    message: 'You have already checked in today.',
    httpStatus: HttpStatus.CONFLICT,
    failCondition: (latestCheckin: MobileCheckIn) =&gt; {
      return (
        !!latestCheckin &amp;&amp;
        !differenceInCalendarDays(
          parse(
            new Date().toLocaleString('en-US', {
              timeZone: latestCheckin.location.timezone,
            }),
          ),
          parse(
            new Date(latestCheckin.modified).toLocaleString('en-US', {
              timeZone: latestCheckin.location.timezone,
            }),
          ),
        )
      );
    },
    i18n: { 'es-PR': 'Ya te has registrado hoy.' },
  },
  mobileNumberRequired: {
    message: 'Mobile number is required.',
    httpStatus: HttpStatus.BAD_REQUEST,
    failCondition: (mobileNumber: string) =&gt; !mobileNumber,
    i18n: { 'es-PR': 'Se requiere número de móvil.' },
  },
};
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Sun Sep 05 2021 12:51:52 GMT+0000 (Coordinated Universal Time)
</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
